#!/usr/bin/env python3

import sys
import os

# Add current directory to path so core can be imported
sys.path.append(os.getcwd())

from core.sources.apkmirror import APKMirrorSource

source = APKMirrorSource(timeout=3, results=5)

search_query = input("Search:\n -> ")
version, link, title = source.get_latest_version(search_query)

if not version:
    sys.exit("No results found.")

print(f"[0] {title}")

download_id = int(input("Enter number to get detail, or 99 to exit:\n -> "))

if download_id == 99:
    sys.exit("Exit")

if download_id != 0:
    sys.exit("Only 0 is supported in this simplified CLI update.")

print(f"Latest version: {version}")
ask_download = input("Do you want to get the direct download link? (y/n)\n -> ")

if ask_download.lower() in ("y", ""):
    print(f"Trying to get direct link...")
    direct_link = source.get_download_url(link)
    if direct_link:
        print(f"Done. Direct url: {direct_link}")
    else:
        print("Failed to get direct link.")
else:
    sys.exit("Exit")
